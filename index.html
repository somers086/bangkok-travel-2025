
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>æ›¼è°·æ—…éŠåŠ©æ‰‹ 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    body { 
      font-family: 'Inter', 'Noto Sans TC', sans-serif; 
      background-color: #F8F9FA; 
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: contain;
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .custom-scrollbar::-webkit-scrollbar { width: 5px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #A4B0F5; border-radius: 10px; }
    
    .app-container { height: 100vh; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
    .main-content { flex: 1; min-height: 0; overflow: hidden; position: relative; }
    
    [v-cloak] { display: none; }
    
    .glass-nav {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
    
    .fade-up-enter-active { transition: all 0.4s ease-out; }
    .fade-up-enter-from { opacity: 0; transform: translateY(20px); }

    @keyframes slide-up {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
  </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.39.0"
  }
}
</script>
</head>
<body class="text-[#2D3436]">
  <div id="app" v-cloak class="app-container max-w-md mx-auto relative shadow-2xl bg-[#F8F9FA]">
    
    <!-- Header -->
    <header class="px-6 pt-12 pb-4 bg-[#F8F9FA] z-30 shrink-0 border-b border-gray-100/50">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-black text-[#4464AD]">
            {{ activeTab === 'itinerary' ? 'æ›¼è°·è¡Œç¨‹ ğŸ‡¹ğŸ‡­' : activeTab === 'finance' ? 'æ—…éŠè¨˜å¸³ à¸¿' : 'å‚™å¿˜æ¸…å–®' }}
          </h1>
          <p class="text-[10px] font-bold text-[#466995] tracking-widest uppercase opacity-60">Feb 25 - Mar 05</p>
        </div>
        <div class="flex space-x-2">
           <button @click="resetData" class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center text-red-300 active:scale-90 transition-all">
             <i data-lucide="refresh-cw" class="w-4 h-4"></i>
           </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- è¡Œç¨‹è¦–åœ– -->
      <div v-if="activeTab === 'itinerary'" class="h-full flex flex-col">
        <div class="shrink-0 bg-[#F8F9FA]/90 backdrop-blur-md border-b border-gray-100 py-4">
          <div class="flex overflow-x-auto whitespace-nowrap px-4 no-scrollbar space-x-2">
            <button v-for="(day, idx) in itinerary" :key="idx" 
              @click="currentDayIdx = idx"
              :class="['px-4 py-2 rounded-xl text-[10px] font-black transition-all duration-300', 
              currentDayIdx === idx ? 'bg-[#4464AD] text-white shadow-lg scale-105' : 'bg-white text-[#A4B0F5] border border-[#A4B0F5]/20']">
              {{ day.dateLabel }}
            </button>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar px-5 pt-5 pb-44">
          <div class="flex justify-between items-end mb-6">
            <div>
              <h2 class="text-lg font-black text-[#4464AD] leading-tight">{{ itinerary[currentDayIdx].title }}</h2>
              <span class="text-[9px] font-black text-[#466995] bg-[#4464AD]/5 px-2 py-0.5 rounded-full uppercase tracking-tighter">
                {{ itinerary[currentDayIdx].spots.length }} å€‹é è¨‚åœ°é»
              </span>
            </div>
            <button @click="showAddModal = true" class="w-10 h-10 rounded-xl bg-[#F58F29] text-white flex items-center justify-center shadow-lg active:scale-90 transition-transform">
              <i data-lucide="plus"></i>
            </button>
          </div>

          <transition-group name="fade-up" tag="div" class="space-y-4">
            <div v-for="spot in itinerary[currentDayIdx].spots" :key="spot.id" 
              class="bg-white p-4 rounded-[28px] border border-gray-100 shadow-sm flex items-start relative overflow-hidden group">
              <div class="w-12 h-12 rounded-[18px] bg-[#A4B0F5]/10 flex flex-col items-center justify-center shrink-0 mr-4 border border-[#A4B0F5]/20">
                <span class="text-[11px] font-black text-[#4464AD]">{{ spot.time }}</span>
                <span class="text-[7px] font-bold text-[#466995]">SPOT</span>
              </div>
              <div class="flex-1 pr-2">
                <h4 class="font-bold text-[#4464AD] text-sm mb-1 leading-snug">{{ spot.name }}</h4>
                <p class="text-[11px] text-gray-400 font-medium leading-relaxed">{{ spot.desc }}</p>
                
                <div v-if="spot.transport" class="mt-2 flex items-center bg-[#F8F9FA] px-2 py-1.5 rounded-xl border border-dashed border-[#A4B0F5]/30">
                  <i data-lucide="info" class="w-3 h-3 text-[#4464AD] mr-1.5 shrink-0"></i>
                  <p class="text-[9px] font-bold text-[#466995]">{{ spot.transport }}</p>
                </div>
                
                <div class="flex mt-4 space-x-2">
                  <a v-if="spot.mapUrl" :href="spot.mapUrl" target="_blank" 
                     class="flex items-center text-[10px] font-black text-white bg-[#4464AD] px-3 py-2 rounded-xl shadow-md active:scale-95 transition-all">
                    <i data-lucide="map" class="w-3 h-3 mr-1.5"></i> é–‹å•Ÿåœ°åœ–
                  </a>
                  <button @click="removeSpot(spot.id)" class="text-[10px] font-black text-red-200 px-2 py-2">
                    ç§»é™¤
                  </button>
                </div>
              </div>
            </div>
          </transition-group>
        </div>
      </div>

      <!-- è¨˜å¸³è¦–åœ– -->
      <div v-if="activeTab === 'finance'" class="h-full overflow-y-auto custom-scrollbar px-5 pt-4 pb-44">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-sm font-black text-[#4464AD] uppercase tracking-widest">æ”¶æ”¯ç¸½è¦½</h2>
          <button @click="showAddExpenseModal = true" class="w-8 h-8 rounded-lg bg-[#F58F29] text-white flex items-center justify-center shadow-md active:scale-90 transition-transform">
            <i data-lucide="plus" class="w-4 h-4"></i>
          </button>
        </div>

        <div class="bg-gradient-to-br from-[#4464AD] to-[#466995] p-8 rounded-[32px] shadow-2xl text-white mb-8 text-center">
          <p class="text-[9px] opacity-70 mb-1 font-bold tracking-widest uppercase">ç¸½æ”¯å‡ºä¼°ç®—</p>
          <h2 class="text-4xl font-black">à¸¿ {{ totalExpenses.toLocaleString() }}</h2>
        </div>
        
        <div class="space-y-3">
          <div v-for="exp in expenses" :key="exp.id" class="bg-white p-4 rounded-2xl border border-gray-100 flex justify-between items-center group">
            <div class="flex items-center space-x-4">
              <div class="w-10 h-10 bg-[#A4B0F5]/10 rounded-xl flex items-center justify-center font-bold text-[#4464AD]">
                <i v-if="exp.cat === 'é¤é£²'" data-lucide="utensils" class="w-4 h-4"></i>
                <i v-else-if="exp.cat === 'äº¤é€š'" data-lucide="car" class="w-4 h-4"></i>
                <i v-else-if="exp.cat === 'è³¼ç‰©'" data-lucide="shopping-cart" class="w-4 h-4"></i>
                <i v-else data-lucide="circle-ellipsis" class="w-4 h-4"></i>
              </div>
              <div>
                <h4 class="text-xs font-bold text-gray-700">{{ exp.note }}</h4>
                <p class="text-[9px] text-gray-400 font-bold uppercase">{{ exp.date }} â€¢ {{ exp.cat }}</p>
              </div>
            </div>
            <div class="flex items-center space-x-3">
              <div class="font-black text-sm text-[#7D4600]">à¸¿{{ exp.amount.toLocaleString() }}</div>
              <button @click="removeExpense(exp.id)" class="p-2 text-red-200">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- å‚™å¿˜æ¸…å–®è¦–åœ– -->
      <div v-if="activeTab === 'shopping'" class="h-full overflow-y-auto custom-scrollbar px-5 pt-4 pb-44">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-sm font-black text-[#4464AD] uppercase tracking-widest">å‚™å¿˜éŒ„</h2>
          <button @click="showAddShoppingModal = true" class="w-8 h-8 rounded-lg bg-[#F58F29] text-white flex items-center justify-center shadow-md active:scale-90 transition-transform">
            <i data-lucide="plus" class="w-4 h-4"></i>
          </button>
        </div>

        <div class="bg-white p-4 rounded-[32px] border border-gray-100 shadow-sm">
          <div class="space-y-1">
            <div v-for="item in shoppingList" :key="item.id" 
              class="flex items-center justify-between py-3 px-2 rounded-xl group hover:bg-gray-50 transition-colors">
              <div class="flex items-center space-x-4 cursor-pointer flex-1" @click="toggleItem(item)">
                <div :class="['w-6 h-6 rounded-full border-2 transition-all flex items-center justify-center', item.done ? 'bg-[#A4B0F5] border-[#A4B0F5]' : 'border-[#A4B0F5]/40']">
                  <i v-if="item.done" data-lucide="check" class="w-3 h-3 text-white"></i>
                </div>
                <span :class="['text-xs font-bold transition-all', item.done ? 'text-gray-300 line-through' : 'text-gray-600']">{{ item.text }}</span>
              </div>
              <div class="flex items-center space-x-1">
                <button @click.stop="openEditShopping(item)" class="p-2 text-gray-300 hover:text-[#4464AD] transition-all">
                  <i data-lucide="pencil" class="w-3.5 h-3.5"></i>
                </button>
                <button @click.stop="removeShoppingItem(item.id)" class="p-2 text-red-100 hover:text-red-400 transition-all">
                  <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                </button>
              </div>
            </div>
          </div>
          <div v-if="shoppingList.length === 0" class="py-12 text-center">
            <p class="text-[10px] font-bold text-gray-300 uppercase tracking-widest">é»æ“Š + æ–°å¢å‚™å¿˜é …ç›®</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 glass-nav border-t border-gray-100/50 px-8 pt-4 pb-8 flex justify-between items-center z-50">
      <button v-for="tab in ['itinerary', 'finance', 'shopping']" @click="activeTab = tab" 
        :class="activeTab === tab ? 'text-[#4464AD]' : 'text-[#A4B0F5]/40'" class="flex flex-col items-center space-y-1">
        <i :data-lucide="tab === 'itinerary' ? 'calendar' : tab === 'finance' ? 'wallet' : 'shopping-bag'" class="w-5 h-5"></i>
        <span class="text-[8px] font-black uppercase tracking-tighter">{{ tab === 'itinerary' ? 'è¡Œç¨‹' : tab === 'finance' ? 'è¨˜å¸³' : 'æ¸…å–®' }}</span>
      </button>
    </nav>

    <!-- Modals -->
    <div v-if="showAddModal || showAddExpenseModal || showAddShoppingModal || showEditShoppingModal" class="fixed inset-0 z-[100] flex items-end justify-center p-4">
      <div class="absolute inset-0 bg-[#4464AD]/20 backdrop-blur-sm" @click="closeAllModals"></div>
      
      <!-- æ–°å¢åœ°é»å½ˆçª— -->
      <div v-if="showAddModal" class="relative w-full max-w-sm bg-white rounded-[32px] p-8 shadow-2xl animate-slide-up">
        <h3 class="text-sm font-black text-[#4464AD] mb-6 uppercase">æ–°å¢åœ°é»</h3>
        <div class="space-y-4">
          <input v-model="newItem.name" placeholder="åç¨±" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold outline-none focus:ring-2 focus:ring-[#A4B0F5]">
          <div class="flex space-x-3">
            <input v-model="newItem.time" type="time" class="flex-1 bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold">
            <input v-model="newItem.transport" placeholder="äº¤é€š" class="flex-1 bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold">
          </div>
          <button @click="addSpot" class="w-full py-5 bg-[#F58F29] text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl active:scale-95 transition-all">ç¢ºèªåŠ å…¥</button>
        </div>
      </div>

      <!-- æ–°å¢æ”¯å‡ºå½ˆçª— -->
      <div v-if="showAddExpenseModal" class="relative w-full max-w-sm bg-white rounded-[32px] p-8 shadow-2xl animate-slide-up">
        <h3 class="text-sm font-black text-[#4464AD] mb-6 uppercase">æ–°å¢æ”¯å‡º</h3>
        <div class="space-y-4">
          <div class="flex space-x-2">
            <button v-for="c in ['é¤é£²', 'äº¤é€š', 'è³¼ç‰©', 'å…¶ä»–']" @click="newExpense.cat = c" :class="newExpense.cat === c ? 'bg-[#4464AD] text-white' : 'bg-gray-100'" class="px-3 py-2 rounded-xl text-[10px] font-bold">{{ c }}</button>
          </div>
          <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡ (à¸¿)" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold">
          <input v-model="newExpense.note" placeholder="é …ç›®å‚™è¨»" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold">
          <input v-model="newExpense.date" placeholder="æ—¥æœŸ (2/25)" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold">
          <button @click="addExpense" class="w-full py-5 bg-[#F58F29] text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl active:scale-95 transition-all">åŠ å…¥å¸³å–®</button>
        </div>
      </div>

      <!-- æ–°å¢æ¸…å–®é …ç›®å½ˆçª— -->
      <div v-if="showAddShoppingModal" class="relative w-full max-w-sm bg-white rounded-[32px] p-8 shadow-2xl animate-slide-up">
        <h3 class="text-sm font-black text-[#4464AD] mb-6 uppercase">æ–°å¢å‚™å¿˜</h3>
        <div class="space-y-4">
          <input v-model="newShoppingText" placeholder="è¼¸å…¥äº‹é …åç¨±" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold outline-none focus:ring-2 focus:ring-[#A4B0F5]">
          <button @click="addShoppingItem" class="w-full py-5 bg-[#F58F29] text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl active:scale-95 transition-all">ç¢ºèªåŠ å…¥</button>
        </div>
      </div>

      <!-- ç·¨è¼¯æ¸…å–®é …ç›®å½ˆçª— -->
      <div v-if="showEditShoppingModal" class="relative w-full max-w-sm bg-white rounded-[32px] p-8 shadow-2xl animate-slide-up">
        <h3 class="text-sm font-black text-[#4464AD] mb-6 uppercase">ç·¨è¼¯é …ç›®</h3>
        <div class="space-y-4">
          <input v-model="editingItem.text" class="w-full bg-gray-50 border-none rounded-2xl px-5 py-4 text-xs font-bold outline-none focus:ring-2 focus:ring-[#A4B0F5]">
          <button @click="saveEditShopping" class="w-full py-5 bg-[#4464AD] text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-xl active:scale-95 transition-all">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

    createApp({
      setup() {
        const activeTab = ref('itinerary');
        const currentDayIdx = ref(0);
        
        const showAddModal = ref(false);
        const showAddExpenseModal = ref(false);
        const showAddShoppingModal = ref(false);
        const showEditShoppingModal = ref(false);

        const newItem = ref({ name: '', time: '12:00', desc: '', transport: '' });
        const newExpense = ref({ cat: 'é¤é£²', amount: null, note: '', date: '2/25' });
        const newShoppingText = ref('');
        const editingItem = ref({ id: null, text: '' });

        const getDefaultItinerary = () => [
          { dateLabel: '2/25 (äºŒ)', title: 'Day 1: å…¥å¢ƒèˆ‡ç™¾è²¨', spots: [
            { id: 1, time: '16:00', name: 'ç´ è¬é‚£æ™®æ©Ÿå ´ (BKK)', desc: 'å…¥å¢ƒè¾¦ç†ã€æ›´æ› SIM å¡ã€é ˜è¡Œæ', transport: 'Airport Link', mapUrl: '' },
            { id: 2, time: '18:00', name: 'é£¯åº— Check-in', desc: 'Nana å€é£¯åº—ä¼‘æ¯', transport: 'Taxi', mapUrl: '' },
            { id: 3, time: '19:30', name: 'Taling Pling (Siam Paragon)', desc: 'ç¬¬ä¸€é¤ç±³å…¶æ—æ¨è–¦æ³°èœ', transport: 'BTS Siam', mapUrl: 'https://maps.app.goo.gl/3u6i2zAYh9CzLCBo9' },
            { id: 4, time: '21:30', name: 'æ°´é–€å¤œå¸‚ (å‚™æ¡ˆ)', desc: 'è‹¥ç™¾è²¨é—œé–€å¯å‰å¾€', transport: 'æ­¥è¡Œ/Tuk Tuk', mapUrl: 'https://maps.app.goo.gl/LazKWchPoGCCwkCF7' }
          ]},
          { dateLabel: '2/26 (ä¸‰)', title: 'Day 2: è€åŸå€èˆ‡ç¾é£Ÿ', spots: [
            { id: 5, time: '10:00', name: 'å—é¾å¸‚å ´ Nang Loeng', desc: 'å‚³çµ±å¸‚å ´å·¡ç¦®', transport: 'Grab', mapUrl: '' },
            { id: 6, time: '13:00', name: 'æŒ‰æ‘©ä¼‘æ¯', desc: 'è€åŸå€æ”¾é¬†', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/91NqTykNtoJV7SR6A' },
            { id: 7, time: '15:00', name: 'å¤§é¦éŸ† & å§å§æ²–èŒ¶', desc: 'å¿…å–æ³°å¥¶åœ°æ¨™', transport: 'Tuk Tuk', mapUrl: 'https://maps.app.goo.gl/xWPGhCfH95UDctwt8' },
            { id: 8, time: '16:30', name: 'K. Panich Sticky Rice', desc: 'èŠ’æœç³¯ç±³é£¯ (é€±æ—¥ä¼‘)', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/kJK4sAmPbS1tGLxs8' },
            { id: 9, time: '18:00', name: 'Krua Apsorn @Dinso', desc: 'ç±³å…¶æ—å¿…æ¯”ç™»æ¨è–¦', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/NrJ3UH2LTJpzH7Ub7' },
            { id: 10, time: '19:30', name: 'Pad Thai Fai Ta Lu', desc: 'ç‚­ç«ç‚’æ²³ç²‰', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/eHTbSdZBuZTFdcBh6' },
            { id: 11, time: '20:30', name: 'Mont NomSod', desc: 'ç‚­çƒ¤åå¸ååº—', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/xnzayx7pJXoY849N6' },
            { id: 12, time: '21:30', name: 'MBK CENTER', desc: 'é€›è¡—ã€æ¡è²·ã€æ™šé¤', transport: 'BTS National Stadium', mapUrl: 'https://maps.app.goo.gl/3u6i2zAYh9CzLCBo9' }
          ]},
          { dateLabel: '2/27 (å››)', title: 'Day 3: åµ©è¶Šè·¯æ¢ç´¢', spots: [
            { id: 13, time: '10:00', name: 'åµ©è¶Šè·¯ & ä¸‰è˜å¸‚å ´', desc: 'æ‰¹ç™¼å¸‚å ´æ¢éšª', transport: 'MRT', mapUrl: 'https://maps.app.goo.gl/FHyFM4w7jxExHN986' },
            { id: 14, time: '11:30', name: 'Milk Toast ç‚­çƒ¤åœŸå¸', desc: 'æ‰‹å·¥æœ¨ç‚­çƒ¤è£½', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/Z3k2vj8rQ4u8MYJaA' },
            { id: 15, time: '13:00', name: 'Jap Bread @Talat Noi', desc: 'å·§å…‹åŠ›é¦™è•‰ç…é¤…', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/bG6u8BnFExKroYeu9' },
            { id: 16, time: '14:00', name: '965bkk å±•å ´', desc: 'æ–‡é’è—è¡“ç©ºé–“', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/ZBtm8Vt2BdWhLa3S7' },
            { id: 17, time: '15:00', name: 'The Summer Coffee', desc: 'å¿…å–ç³–çµ²å’–å•¡', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/DQBNFHXVYW7R1kqC8' },
            { id: 18, time: '16:30', name: 'Hong Sieng Kong', desc: 'é¦™æ¸¯è€å®…æ²³ç•”å’–å•¡', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/uFF3CwsAWrHXVMq57' },
            { id: 19, time: '18:00', name: 'Pista& é–‹å¿ƒæœå†°', desc: 'æ‰‹ä½œé–‹å¿ƒæœç”œé»', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/JRYdXYVBZU2bLqbw8' },
            { id: 20, time: '19:30', name: 'Sam Lor (æ™šé¤)', desc: 'å¿…æ¯”ç™»èˆ’æœé›·è›‹é£¯', transport: 'Grab', mapUrl: 'https://maps.app.goo.gl/YucY1ptKEZQK9LAf7' },
            { id: 21, time: '21:30', name: 'æš¹ç¾…å»£å ´/ä¸­å¤®ä¸–ç•Œ', desc: 'é£¯åº—ä¼‘æ¯å¾Œé€›è¡—', transport: 'BTS Siam', mapUrl: 'https://maps.app.goo.gl/qXfQurhsVUxVbPLj8' }
          ]},
          { dateLabel: '2/28 (äº”)', title: 'Day 4: å¸‚é›†èˆ‡å¤œå¸‚', spots: [
            { id: 22, time: '11:00', name: 'æ´½åœ–æ°é€±æœ«å¸‚é›†', desc: 'å…¨æ›¼è°·æœ€å¤§é€±æœ«å¸‚é›†', transport: 'BTS Mo Chit', mapUrl: 'https://maps.app.goo.gl/jDgMmK7yxmGwUb8YA' },
            { id: 23, time: '19:00', name: 'åŸå ¡å¤œå¸‚ Jodd Fairs', desc: 'ç¶²ç´…ç¾é£Ÿå¤œå¸‚', transport: 'MRT Rama 9', mapUrl: 'https://maps.app.goo.gl/vzxFNphrS5VUWWFx8' }
          ]},
          { dateLabel: '3/01 (å…­)', title: 'Day 5: å¸­éš†å€åŸŸå·¡ç¦®', spots: [
            { id: 24, time: '12:00', name: 'Central Park Bangkok', desc: 'ç±³å…¶æ—ä¸€æ¢è¡—', transport: 'BTS Sala Daeng', mapUrl: 'https://maps.app.goo.gl/R6mW2sED5uJrvtNc8' },
            { id: 25, time: '15:00', name: 'Tawanchai Fresh Milk', desc: 'å··å¼„å¿…å–é®®å¥¶', transport: 'æ­¥è¡Œ', mapUrl: 'https://maps.app.goo.gl/DmAFCKE68ifGycCq8' },
            { id: 26, time: '19:00', name: 'Save One Go Market', desc: 'ç•¶åœ°äººå¤§æ¨å¤œå¸‚', transport: 'BTS Yaek Kor Por Aor', mapUrl: 'https://maps.app.goo.gl/45ovTXME2ViFhLGN8' }
          ]},
          { dateLabel: '3/02 (æ—¥)', title: 'Day 6: è³ªæ„Ÿç”Ÿæ´»èˆ‡é€›è¡—', spots: [
            { id: 27, time: '12:00', name: 'Fa pla tahn', desc: 'Central Chidlom å¤§èˆ¹éºµ', transport: 'BTS Chidlom', mapUrl: 'https://maps.app.goo.gl/DwQuCafADh9oRK7e6' },
            { id: 28, time: '14:30', name: 'Piccolo Vicolo Cafe', desc: 'è³ªæ„Ÿç¶ æ´²å’–å•¡', transport: 'BTS Ratchathewi', mapUrl: 'https://maps.app.goo.gl/zKXQKetsyF97JBxr9' },
            { id: 29, time: '18:00', name: 'ä¸­å¤®ä¸–ç•Œå•†å ´', desc: 'æœ€å¾Œé€›è¡—æ¡è²·', transport: 'BTS Siam', mapUrl: 'https://maps.app.goo.gl/k25XNma22C6gQAJs7' }
          ]},
          { dateLabel: '3/03 (ä¸€)', title: 'Day 7: å½ˆæ€§æ´»å‹•', spots: [{id: 98, time: '12:00', name: 'è‡ªç”±å®‰æ’', desc: 'æŒ‰æ‘©æˆ–è£œé€›æ™¯é»', transport: '-', mapUrl: ''}]},
          { dateLabel: '3/04 (äºŒ)', title: 'Day 8: æœ€å¾Œæ¡è²·', spots: [{id: 99, time: '12:00', name: 'è¶…å¸‚æƒè²¨', desc: 'Big C æˆ–ä¼´æ‰‹ç¦®', transport: '-', mapUrl: ''}]},
          { dateLabel: '3/05 (ä¸‰)', title: 'Day 9: å›ç¨‹å¤§é¤', spots: [
            { id: 30, time: '11:00', name: 'Savoey @Chidlom', desc: 'å®‰åšæ¨è–¦æµ·é®®é¤', transport: 'BTS Chidlom', mapUrl: 'https://maps.app.goo.gl/vHXpSwYCAQJi22fDA' },
            { id: 31, time: '15:00', name: 'å‰å¾€ BKK æ©Ÿå ´', desc: 'é ç•™ 3 å°æ™‚ææ—©æŠµé”', transport: 'Taxi', mapUrl: '' }
          ]}
        ];

        // å‡ç´š LocalStorage ç‰ˆæœ¬è™Ÿï¼Œå¼·åˆ¶åˆ·æ–°è³‡æ–™
        const itKey = 'bkk_itinerary_v5';
        const exKey = 'bkk_expenses_v5';
        const shKey = 'bkk_shopping_v5';

        const itinerary = ref(JSON.parse(localStorage.getItem(itKey)) || getDefaultItinerary());
        const expenses = ref(JSON.parse(localStorage.getItem(exKey)) || []);
        const shoppingList = ref(JSON.parse(localStorage.getItem(shKey)) || [
          { id: 1, text: 'è­·ç…§ç°½è­‰', done: true },
          { id: 2, text: 'æ³°éŠ–ç¾é‡‘', done: true },
          { id: 3, text: 'å¸¸ç”¨è—¥å“', done: false }
        ]);

        watch(itinerary, v => localStorage.setItem(itKey, JSON.stringify(v)), { deep: true });
        watch(expenses, v => localStorage.setItem(exKey, JSON.stringify(v)), { deep: true });
        watch(shoppingList, v => localStorage.setItem(shKey, JSON.stringify(v)), { deep: true });

        const totalExpenses = computed(() => expenses.value.reduce((s, e) => s + (Number(e.amount) || 0), 0));

        const closeAllModals = () => {
          showAddModal.value = false;
          showAddExpenseModal.value = false;
          showAddShoppingModal.value = false;
          showEditShoppingModal.value = false;
          newShoppingText.value = '';
        };

        const addSpot = () => {
          if (!newItem.value.name) return;
          itinerary.value[currentDayIdx.value].spots.push({ id: Date.now(), ...newItem.value });
          itinerary.value[currentDayIdx.value].spots.sort((a,b) => a.time.localeCompare(b.time));
          closeAllModals();
          newItem.value = { name: '', time: '12:00', desc: '', transport: '' };
        };

        const removeSpot = (id) => itinerary.value[currentDayIdx.value].spots = itinerary.value[currentDayIdx.value].spots.filter(s => s.id !== id);
        
        const addExpense = () => {
          if (!newExpense.value.amount) return;
          expenses.value.unshift({ id: Date.now(), ...newExpense.value });
          closeAllModals();
          newExpense.value = { cat: 'é¤é£²', amount: null, note: '', date: '2/25' };
        };

        const removeExpense = (id) => expenses.value = expenses.value.filter(e => e.id !== id);

        // --- ä¿®å¾©å‚™å¿˜æ¸…å–®æ–°å¢åŠŸèƒ½ ---
        const addShoppingItem = () => {
          if (!newShoppingText.value || !newShoppingText.value.trim()) return;
          shoppingList.value.push({ 
            id: Date.now(), 
            text: newShoppingText.value.trim(), 
            done: false 
          });
          newShoppingText.value = '';
          showAddShoppingModal.value = false; // é—œé–‰å½ˆçª—
        };

        const toggleItem = (item) => item.done = !item.done;

        const openEditShopping = (item) => {
          editingItem.value = { ...item };
          showEditShoppingModal.value = true;
        };

        const saveEditShopping = () => {
          const idx = shoppingList.value.findIndex(i => i.id === editingItem.value.id);
          if (idx !== -1 && editingItem.value.text.trim()) {
            shoppingList.value[idx].text = editingItem.value.text.trim();
          }
          closeAllModals();
        };

        const removeShoppingItem = (id) => shoppingList.value = shoppingList.value.filter(i => i.id !== id);

        const resetData = () => {
          if (confirm('ç¢ºå®šè¦é‚„åŸé è¨­è¡Œç¨‹å—ï¼Ÿæ‚¨çš„è‡ªå®šç¾©è¡Œç¨‹èˆ‡é–‹éŠ·å°‡æœƒéºå¤±ã€‚')) {
            itinerary.value = getDefaultItinerary();
            expenses.value = [];
            shoppingList.value = [{ id: 1, text: 'è­·ç…§ç°½è­‰', done: true }, { id: 2, text: 'æ³°éŠ–ç¾é‡‘', done: true }];
          }
        };

        onMounted(() => lucide.createIcons());
        watch([activeTab, currentDayIdx, shoppingList, showAddModal, showAddExpenseModal, showAddShoppingModal, showEditShoppingModal], () => {
          nextTick(() => lucide.createIcons());
        }, { deep: true });

        return { 
          activeTab, itinerary, currentDayIdx, expenses, shoppingList, totalExpenses, 
          showAddModal, showAddExpenseModal, showAddShoppingModal, showEditShoppingModal,
          newItem, newExpense, newShoppingText, editingItem,
          addSpot, removeSpot, addExpense, removeExpense, addShoppingItem, 
          toggleItem, openEditShopping, saveEditShopping, removeShoppingItem, closeAllModals, resetData 
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
